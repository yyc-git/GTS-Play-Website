---
sidebar_position: 2
---

# 职业模组

## 1. 职业模组简介

职业模组是【巨大娘的玩耍】游戏中的一种核心模组类型，用于定义游戏角色的职业信息和特性。玩家可以通过选择不同的职业来获得不同的游戏体验和战斗策略。

职业模组主要包含以下功能：
- 定义职业的基本信息（名称、图标、所需宝石、适用的角色类型等）
- 定义职业包含的职业特性

职业模组的参考实现详见`protocols/career-protocol/reference/`

## 2. 职业模组使用的协议

职业模组使用的核心协议是 `career-protocol`，该协议定义了职业模组的服务和数据。



## 3. 模块前缀命名规范

职业模组的名称请使用 `career-` 作为前缀，例如：
- `career-test1`
- `career-warrior`
- `career-mage`



## 4. 职业协议定义

### 4.1 服务接口（ServiceType）

职业协议的服务接口定义在 `career-protocol/src/service/ServiceType.ts` 中：

```typescript
import { state } from "../state/StateType";
import { api } from "types/src/APIType"
import { characterType, careerFeatureValue, careerFeatureName } from "types/src/ImportedTypes"

export type careerData = {
    // 职业名称
    title: string,          
    // 职业图标ID
    iconId: string,         
    // 解锁职业所需的宝石数量
    needGem: number,        

	// 获取职业特性数据
	getCareerFeatureData: (state: state) => Record<
		careerFeatureName, careerFeatureValue
	>
}

// 职业服务接口
export type service = {
    // 获取职业数据
    getCareerData: (api: api, state: state) => careerData,
    
    // 获取职业适用的角色类型
    getCharacterType: () => characterType,
};
```

### 4.2 数据类型（StateType）

职业协议的数据类型定义在 `career-protocol/src/state/StateType.ts` 中：

```typescript
import { careerFeatureName, careerFeatureValue } from "types/src/ImportedTypes"

export type state = {
    //通常没有该字段，只有在需要时才会填充
    careerFeatureData?: Record<careerFeatureName, careerFeatureValue>,
}
```



## 5. 实现代码详解（Main.ts）

### 5.1 导入部分

```typescript
import { service } from "career-protocol/src/service/ServiceType"
import { state } from "career-protocol/src/state/StateType"
import { getBlockService as getBlockServiceBlockManager, textData, needGem } from "types/src/CommonType"
import { characterType } from "types/src/ImportedTypes"
```

- `service`: 职业协议定义的服务接口类型
- `state`: 职业协议定义的数据类型
- `getBlockServiceBlockManager`: 通用类型定义，用于实现模组服务
- `textData`: 文本数据类型，用于多语言支持
- `needGem`: 所需宝石数量的枚举
- `characterType`: 角色类型枚举

### 5.2 多语言支持

```typescript
export enum languageKey {
    Title,
}

// 获取中文、英文的文本数据
let _getTextData = (): textData => {
    return {
        ["Chinese"]: {
            [languageKey.Title]: "测试1"
        },
        ["English"]: {
            [languageKey.Title]: "Test1"
        }
    }
}
```

- `languageKey`: 定义文本数据的键值枚举
- `_getTextData`: 返回多语言文本数据的函数，支持中文和英文

### 5.3 职业服务实现示例

```typescript
export let getBlockService: getBlockServiceBlockManager<service> = (api) => {
    return {
        getCareerData: (api, state) => {
            return {
                //职业名称
                title: api.getLanguageDataByData(state, _getTextData(), languageKey.Title),
                //职业图标ID，对应asset/目录下的图标文件名
                iconId: "career_test1_icon",
                //需要的宝石数量
                needGem: needGem.Middle,
                //包含的职业特性
                getCareerFeatureData: (state) => api.MutableRecordUtils.createFromObject({
                    //key是职业特性的名称，value是职业特性的参数。value会传入职业特性模组服务的getFeatureData函数返回的applyFunc函数的value参数中
                    //例如，career-feature-increasefullhp->Main.ts->getBlockService->getFeatureData->applyFunc函数会收到0.5作为value参数

                    //生命上限增加50%
                    [api.getCareerFeatureName(api, state, "career-feature-increasefullhp")]: 0.5,

                    //每持有50金币，伤害增加1%
                    [api.getCareerFeatureName(api, state, "career-feature-increasedamagebycoin")]: 0.01,
                    //减少100%伤害。受到攻击后，增加50%伤害，持续20秒
                    [api.getCareerFeatureName(api, state, "career-feature-reducedamagebutincreasewhendamaged")]: [1, 0.5, 20],
                })
            }
        },
        //职业适用的角色类型（此处是巨大娘或者小人）
        getCharacterType: () => characterType.GiantessOrLittleMan,
    }
}
```

### 5.4 数据创建

```typescript
export let createBlockState: createBlockStateBlockManager<state> = (api) => {
    return {}
}
```

- 创建模组的初始数据，通常为空



## 6. 开发注意事项

### 6.1 多语言支持

- 所有文本都应使用`api.getLanguageDataByData`方法获取
- 确保提供中文和英文两种语言支持



### 6.2 依赖管理

- 在`package.json->mod->dependentMods`中正确配置依赖的职业特性模组
<!-- - 确保依赖的模组版本兼容 -->

<!-- ## 7. 常见问题

### 7.1 职业无法显示

- 检查`package.json`中的`protocolName`是否正确设置为`career-protocol`
- 确保`iconId`对应的图标文件存在

### 7.2 多语言显示问题

- 确保所有文本都使用了`getLanguageDataByData`方法
- 检查语言键值和文本数据的格式是否正确 -->

---

通过以上内容，你已经了解了职业模组的开发方法和注意事项。祝你开发顺利！