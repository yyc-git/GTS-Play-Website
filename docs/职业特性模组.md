---
sidebar_position: 3
---

# 职业特性模组

## 1. 职业特性模组简介

职业特性模组是【巨大娘的玩耍】游戏中的一种核心模组类型，用于定义职业所拥有的具体特性和能力。这些特性会为角色提供各种游戏效果，如属性加成、技能效果等，是区分不同职业玩法的关键要素。

职业特性模组主要包含以下功能：
- 定义特性的基本信息（名称、描述等）
- 特性的具体效果逻辑
- 定义随机职业选中该特性时的相关参数

职业特性模组的参考实现详见`protocols/career-feature-protocol/reference/CareerFeatureData->getCareerFeatureData`

## 2. 职业特性模组使用的协议

职业特性模组使用的核心协议是 `career-feature-protocol`，该协议定义了职业特性模组的服务和数据。



## 3. 模块前缀命名规范

职业特性模组的名称请使用 `career-feature-` 作为前缀，例如：
- `career-feature-increasefullhp`
- `career-feature-increasedamagebycoin`
- `career-feature-reducedamagebutincreasewhendamaged`



## 4. 职业特性协议定义

### 4.1 服务接口（ServiceType）

职业特性协议的服务接口定义在 `career-feature-protocol/src/service/ServiceType.ts` 中：

```typescript
import { state, careerFeatureData } from "types/src/ImportedTypes"
import { api } from "types/src/APIType"

// 职业特性服务接口
export type service = {
    // 获取特性数据
	getFeatureData: (api: api, state: state) => careerFeatureData,
};
```

### 4.2 数据类型（StateType）

职业特性协议的数据类型定义在 `career-feature-protocol/src/state/StateType.ts` 中：

```typescript
export type state = null
```



## 5. 实现代码详解（Main.ts）

### 5.1 导入部分

```typescript
import { service } from "career-feature-protocol/src/service/ServiceType"
import { state } from "career-feature-protocol/src/state/StateType"
import { getBlockService as getBlockServiceBlockManager, textData } from "types/src/CommonType"
```

- `service`: 职业特性协议定义的服务接口类型
- `state`: 职业特性协议定义的数据类型
- `getBlockServiceBlockManager`: 通用类型定义，用于实现模组服务
- `textData`: 文本数据类型，用于多语言支持

### 5.2 多语言支持

```typescript
export enum languageVariableKey {
    Description
}

let _getTextDataByVariable = (): variableTextData => {
    return {
        ["Chinese"]: {
            [languageVariableKey.Description]: (value) => `生命上限增加${value}%`
        },
        ["English"]: {
            [languageVariableKey.Description]: (value) => `Maximum health increased by ${value}%`
        }
    }
}
```

- `languageVariableKey`: 定义文本数据的键值枚举
- `_getTextDataByVariable`: 返回带参数的多语言文本数据的函数，支持中文和英文

### 5.3 职业特性服务实现示例

```typescript
export let getBlockService: getBlockServiceBlockManager<service> = (api) => {
    return {
        getFeatureData: (api, state) => {
            return {
                // 特性名称
                name: getName(),
                // 是否是正面特性
                positive: true,
                //适用的角色类型（此处是巨大娘或者小人）
                characterType: characterType.GiantessOrLittleMan,
                //随机职业选中该特性的几率
                rate: rate.Middle2,
                //特性描述
                getDescriptionFunc: (state, value) => {
                    return api.getLanguageDataByData(state, _getTextDataByVariable(), languageVariableKey.Description)(api.NumberUtils.convertDecimalToPercent(value, 3))
                },
                /**
                 * 生成随机的value值（此处是生成0.2到1之间的随机浮点数，表示生命上限增加20%到100%）
                 * @description 仅供随机职业选中该特性时使用
                 */
                generateRandomValueFunc: (state) => {
                    return api.NumberUtils.getRandomFloat(0.2, 1)
                },
                /**
                 * 特性的具体效果逻辑
                 * @description 应用该特性时调用的函数
                 * @param state 游戏状态
                 * @param characterType_ 使用该特性的角色类型
                 * @param value 职业模组->getCareerFeatureData函数传来的value
                 * @param name 特性名称
                 */
                applyFunc: (state, characterType_, value, name) => {
                    //此处该函数会被调用两次，分别作用于巨大娘和小人角色

                    switch (characterType_) {
                        //对于小人角色，增加他的生命上限
                        case characterType.LittleMan:
                            state = api.LittleManBuildUtils.setHp(state, (state, hp) => {
                                return hp * (1 + value)
                            }, true)
                            break
                        //对于巨大娘角色，增加她的生命上限
                        case characterType.Giantess:
                            state = api.GiantessBuildUtils.setFullHp(state, (state, hp) => {
                                return hp * (1 + value)
                            }, true, usedGirlEnum.PlayerGirl)
                            break
                    }

                    return Promise.resolve(state)
                },
            }
        }
    }
}
```

### 5.4 数据创建

```typescript
export let createBlockState: createBlockStateBlockManager<state> = (api) => {
    return null
}
```

- 创建模组的初始数据，此处为空



## 6. 开发注意事项

### 6.1 多语言支持

- 所有文本都应使用`api.getLanguageDataByData`方法获取
- 确保提供中文和英文两种语言支持



### 6.2 依赖管理

- 在`package.json->mod->dependentMods`中正确配置依赖的模组
<!-- - 确保依赖的模组版本兼容 -->

<!-- ## 7. 常见问题

### 7.1 特性效果不生效

- 检查`package.json`中的`protocolName`是否正确设置为`career-feature-protocol`
- 确保特性的`applyFunc`函数实现正确
- 检查特性是否被正确添加到职业模组的`getCareerFeatureData`配置中

### 7.2 多语言显示问题

- 确保所有文本都使用了`getLanguageDataByData`方法
- 检查语言键值和文本数据的格式是否正确 -->

---

通过以上内容，你已经了解了职业特性模组的开发方法和注意事项。祝你开发顺利！